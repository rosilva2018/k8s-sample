on:
  push: 
   branches: [ main ]
   tags:
       - 'v*.*.*'
  pull_request:
   branches: [ main]
   
  workflow_dispatch:
  
jobs:
   build-and-push:
     runs-on: ubuntu-latest
     steps:
     - uses: actions/checkout@v2
     - uses: docker://ghcr.io/kciter/aws-ecr-action:latest
       with:
         access-key-id: ${{ secrets.ACCESS_KEY_ID }}
         secret-access-key: ${{ secrets.SECRET_ACCESS_KEY }}
         account_id: ${{ secrets.ACCOUNT_ID }}
         repo: app-sample
         region: us-east-1
         tags: latest,${{ github.sha }}
         create_repo: true
         image_scanning_configuration: true
         set_repo_policy: true
         repo_policy_file: repo-policy.json
